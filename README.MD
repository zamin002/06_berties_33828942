# Berties Books – Dynamic Web Applications Lab 6  
**Student ID:** 33828942

This project is the completed implementation of the Berties Books web application for Lab 6.  
It is a Node.js + Express web app connected to a MySQL database, using EJS templates for rendering and deployed on a Goldsmiths VM.

---

## 1. How to Install and Run (Local Machine)

### Clone the repository

git clone https://github.com/zamin002/06_berties_33828942


cd 06_berties_33828942


### Install dependencies

npm install


### Set up the local MySQL database
Start MySQL, then run:

source create_db.sql;
source insert_test_data.sql;


### Run the application locally

npm start


The app will be available at:

http://localhost:8000


---

## 2. Deployment on the Goldsmiths VM

### SSH into your VM

ssh <your-username>@doc.gold.ac.uk


### Clone the repo and install modules

git clone https://github.com/zamin002/06_berties_33828942


cd 06_berties_33828942
npm install


### Set up the database on the VM
Open MySQL:

sudo mysql

Run:

source create_db.sql;
source insert_test_data.sql;


### Run the app using **forever**

forever start main.js


The live app will be available at:  

http://www.doc.gold.ac.uk/usr/33828942/

---

## 3. App Features

- View all books  
- Add a new book  
- List bargain books (price < £20)  
- Search books (exact + partial match using LIKE)  
- Displays results via EJS templates  
- Works locally and on the VM  

---

## 4. Routes Summary

| Route | Description |
|-------|-------------|
| `/books/list` | View all books |
| `/books/addbook` | Add book form |
| `/books/bookadded` | Insert new book |
| `/books/bargainbooks` | Books under £20 |
| `/books/search` | Search form |
| `/books/search_result` | Search results |

---

## 5. Technologies Used

- Node.js  
- Express.js  
- MySQL  
- mysql2  
- EJS  
- CSS  
- Forever  

---
## 6. dotenv

I used the dotenv package to remove hard-coded database credentials from the code.
I created a .env file that stores DB_HOST, DB_USER, DB_PASSWORD, and DB_DATABASE.
In my index.js I called require('dotenv').config() and changed the MySQL pool to use process.env variables.
This improves security and makes deployment easier.
---
## 7. audit

I implemented login auditing so that every login attempt (successful or failed) is recorded.

I created a table called login_audit:

CREATE TABLE login_audit (
  id INT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(100),
  success TINYINT(1) NOT NULL,
  ip_address VARCHAR(45),
  timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);


Inside the /users/loggedin route, every login attempt inserts a row into this table:

attempted username

whether the password matched (success = 1 or 0)

user’s IP address (req.ip)

timestamp (auto-generated by MySQL)

I added a route /users/audit which queries the table and displays the results using audit.ejs.

This provides a simple audit trail showing when users log in and whether the attempt was successful.

## 8. Access Control
I used a redirectLogin middleware to protect certain routes.

Public routes: home, about, viewing and searching books.

Protected routes:

/users/list – shows personal data of registered users.

/users/audit – shows login attempts and IP addresses.

/books/addbook  – changes the inventory and is restricted to logged-in users only.

The user must log in successfully (which sets req.session.userId) to access these routes, otherwise they are redirected to the login page.